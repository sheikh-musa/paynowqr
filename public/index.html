<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Paynow QR Generator</title>
    <script src="js/paynow.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script>
      function generate_qr_code(str, divId) {
        // Clear existing QR code if any
        var qrContainer = document.getElementById(divId);
        qrContainer.innerHTML = "";

        // Generate QR Code using qrcode library
        QRCode.toDataURL(str, { width: 250, height: 250, colorDark: "#000000", colorLight: "#ffffff" })
          .then((url) => {
            var img = document.createElement("img");
            img.src = url;
            img.style.cursor = "pointer";
            img.addEventListener("click", function () {
              downloadImage(url, "QRCode.png");
            });
            qrContainer.appendChild(img);

            var instructionText = document.createElement("p");
            instructionText.innerText = "Click QR code to save";
            qrContainer.appendChild(instructionText);
          })
          .catch((err) => {
            console.error(err);
            // handle error case here
          });
      }

      function downloadImage(data, filename) {
        var a = document.createElement("a");
        a.href = data;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }

      function generateQRCode() {
        var number = document.getElementById("number").value;
        var amount = document.getElementById("amount").value;
        var reference = document.getElementById("reference").value;
        var type = document.querySelector('input[name="mobileUen"]:checked').value;

        const opts = {
          number: number,
          amount: amount,
          reference: reference,
          type: type,
        };
        // console.log(opts);
        const qrstr = generatePayNowStr(opts);
        generate_qr_code(qrstr, "qrcode");
      }
    </script>
  </head>
  <body>
    <div>
      <label for="mobileUen">Type:</label><br />
      <input type="radio" id="mobile" name="mobileUen" value="mobile" checked />
      <label for="mobile">Mobile</label><br />
      <input type="radio" id="uen" name="mobileUen" value="uen" />
      <label for="uen">UEN</label><br /><br />

      <label for="number">Number:</label>
      <input type="text" id="number" name="number" /><br /><br />

      <label for="amount">Amount:</label>
      <input type="text" id="amount" name="amount" /><br /><br />

      <label for="reference">Reference:</label>
      <input type="text" id="reference" name="reference" /><br /><br />

      <button onclick="generateQRCode()">Submit</button>
    </div>
    <br /><br />
    <div id="qrcode"></div>
  </body>
</html>
